<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Study Buddy AI</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<div class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="brand">
            <img src="/static/logo.png" alt="logo">
            <h2>Study Buddy</h2>
        </div>

        <p class="tagline">Your notes. Your answers.</p>

        <form id="uploadForm" onsubmit="uploadPdfs(event)">
            <label class="upload-btn">
                ðŸ“„ Upload PDFs
                <input type="file" id="pdfInput" name="pdfs" multiple hidden>
            </label>
            <button class="process-btn" type="submit">Process Notes</button>
        </form>

        <div class="topics">
            <h4>ðŸ“Œ Topics</h4>
            <ul id="topicList">
                <li>No topics yet</li>
            </ul>
        </div>
    </aside>

    <!-- Main chat area -->
    <main class="chat-area">
        <header class="chat-header">
            <h1>Ask your study questions</h1>
            <p>Short answers â€¢ Easy language â€¢ From your notes</p>
        </header>

        <div id="chatBox" class="chat-box">
            <div class="msg bot">
                ðŸ‘‹ Hi! Upload your PDFs and start asking questions.
            </div>
        </div>

        <div class="chat-input-area">
            <form onsubmit="ask(event)">
                <input id="question" type="text" placeholder="Type your question here...">
                <button type="submit">Ask</button>
            </form>
            <button class="clear-btn" onclick="clearChat()">Clear</button>
        </div>
    </main>
</div>

<div id="toast" class="toast"></div>

<script>
async function uploadPdfs(e) {
    e.preventDefault();
    const input = document.getElementById("pdfInput");
    if (!input.files.length) {
        showToast("Please select PDFs first", true);
        return;
    }

    const formData = new FormData();
    for (let f of input.files) formData.append("pdfs", f);

    const res = await fetch("/upload", { method: "POST", body: formData });
    const data = await res.json();

    document.getElementById("uploadForm").reset();
    showToast(data.message);

    const list = document.getElementById("topicList");
    list.innerHTML = "";
    data.files.forEach(f => {
        const li = document.createElement("li");
        li.textContent = f.replace(/\.pdf$/i, "");
        list.appendChild(li);
    });
}

async function ask(e) {
    e.preventDefault();
    const qInput = document.getElementById("question");
    const q = qInput.value.trim();
    if (!q) return;

    const box = document.getElementById("chatBox");
    box.innerHTML += `<div class="msg user">${q}</div>`;
    qInput.value = "";

    const typing = document.createElement("div");
    typing.className = "msg bot";
    typing.textContent = "Thinking...";
    box.appendChild(typing);
    box.scrollTop = box.scrollHeight;

    const form = new FormData();
    form.append("question", q);

    try {
        const res = await fetch("/ask", { method: "POST", body: form });
        const ans = await res.text();
        typing.remove();
        box.innerHTML += `<div class="msg bot">${ans.replace(/\n/g,"<br>")}</div>`;
    } catch {
        typing.textContent = "Error getting response";
    }
    box.scrollTop = box.scrollHeight;
}

function clearChat() {
    document.getElementById("chatBox").innerHTML =
        `<div class="msg bot">Chat cleared. Ask something new ðŸ˜Š</div>`;
}

function showToast(msg, error=false) {
    const t = document.getElementById("toast");
    t.textContent = msg;
    t.className = "toast show" + (error ? " error" : "");
    setTimeout(() => t.className = "toast", 2500);
}
</script>

</body>
</html>
